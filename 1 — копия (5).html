<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAOGSURBVDhPJdJ9TNVVGMDxw+Wde3kRdAaasYFtWoQjnWGb4gAHm6CoTSWJtLRZKFlpN3IE4y0TVOLu8uKQeyUYhLw4UEQkr0HCeBsxSSMBB0hCtdC8jZj67UH+ODvP7+yczznP8/xUSlkbwatWsszLFR93BzYE+rDzQDRvpyYQZ/iKOPNpYi+Y2H3dQnzfEAdv/867faNsycvBf6kbam9WBSFLdNjYKXRKEfWqF4lHd/FxfgqflKRx5LtvSGwo4fDPPSSP3MMwPsnpv2c5+NsQgd5aVOArqwnxckEJsFzGntXepCfHk3E+i/Ti46SXp5Px0wXSJocxPvqLGquVstmnfH6jlvVuGpTO0YlVrjqUo2KRvGCdqw36qCAMBccwmJLIzT9E7qkEMs98QVbecXKqizD80sOhT7exSSuAjb0GPyfH50Ck9wLCX3Bl8yJb0mICKKn4ksKGk+Slx5IcvpK0t8IwtfXQBOzbG0uokw1KOWh4UzufQpCblsXOtrKoeF3G+ZoMOmVzUVs9Oz0VAbJ2OCwMQ+ZpPgwOYIONkheIErHY4znga2dLqP9Clkm8VjZX/VBEtwDm/layIvz4en8ENb29FDddQr/xJTbKPqV0Grxd5m8N1SoS31hKsMTvL1HU3u/i5tNZKv+dwmgpo7CzmnLrGDcErRtu5T1puVJudlJJW9zl0Acr3Ihf4cI6ibP3hVD+aJi+mcdceTiO+XYzpXctXPnzVx4+e8ITQaos1XOAPcrDjoVyaP+LzkS7KzZJbpXVJ2jAiuW/aWoH6vn+ZikXJ+/Qa50W4BkzAvRYpwRwnQc8BXjHS0OMAJESm08doLi+iEvN5VRWJHGx7iSNU2Pcsj7m7sw/jM5YaZ++L4BW8neXfjrIT+TlwNFwfyKlFvrQ5RibTRQ0mym8WkzpjxU0jN+j68EE3ROjDPzxgJaJYQFcpJI66afMc5Xf8rIbMX5aMnYHc9aYRI6liuyBDqoG+2kbHeH60B06Rga5NTZC4+CAAM4CzCFyq48Aa+R7m4c9H3nr0Psu4ExcFKnF2Rg7W6nqbqeiq526vk5a+vswdXYIIH+gcppHXKSvr0m8Vtp6ZH0QydGhpOr1JBiz+ezqZZKbGkiRkXmtkeyWaxy7XC+AvRyW/OcgW5n95AUBnhoi1/iyfUcIW5MS2Jx7gq3nCthuPsuu0nPsKTOzo9REWP63/A9LfT5MoLhg6gAAAABJRU5ErkJggg==">
  <title>Doc</title>
  <style>
  *:not(hr), *::after, *::before {box-sizing: border-box;margin:0;padding:0;border:0}ul {list-style-type: none}
#i{padding: 0px 0;display: inline-block;background: linear-gradient(rgba(0,0,0,0.9), blue); 
text-align: center;
}
.hide{display:none}

label{margin:2px; padding: 7px; display: inline-block; background:#ded;border:2px solid green; cursor: pointer;}
  .palet {display:flex;}
  .palet .color {width:24px; height:24px;background: white;border:1px solid blue;}
  </style>  
</head>
<body text="black" bgcolor="white">
<a href="file:///K:/!/projAll/html2/dig2.html">feb2023</a>
<a href="file:///K:/!/projAll/html1/main.html">dec2023</a>
<a id="a4" href="file:///K:/!/projAll/css_%D0%BF%D1%81%D0%B5%D0%B2%D0%B4%D1%8B/index.html">два кота
(с iframes)
</a>


<div id=i>
<svg id="svg" width="900" height="415" viewBox="0 0 900 415" fill="none"
onmousedown="
if(curve.checked){
	const o={x:event.clientX-i.offsetLeft,y:event.clientY-i.offsetTop+window.pageYOffset};
	//const o={x:e.clientX-i.offsetLeft,y:e.clientY-i.offsetTop+window.pageYOffset};	
	// попал в заповедную зону
	let g=-1;// нарушитель
	for (let i=0;i<a.length;i++)if(((a[i].x-o.x)*(a[i].x-o.x)+(a[i].y-o.y)*(a[i].y-o.y))<160)g=i;
	if (g>-1)
		{
			c=g;	
			vw();
		}
		else
		{
			a.push(o);
			c=a.length-1;
			bz.push(true);	
			vw();
		}
}
else{
dawn['down']=true;
dawn.x=event.clientX-i.offsetLeft; 
dawn.y=event.clientY-i.offsetTop;
eff.setAttribute('x',dawn.x);
eff.setAttribute('y',dawn.y);
eff.classList.remove('hide');
}
"

onmousemove="
if(curve.checked){}
else{
//console.log(dawn+' '+n);
//console.log(au);
if(dawn['down']){
let x=dawn.x-event.clientX+i.offsetLeft;
let y=dawn.y-event.clientY;
eff.setAttribute('width',Math.abs(x));
eff.setAttribute('height',Math.abs(y));
dawn.w=Math.abs(x);
dawn.h=Math.abs(y);
}
}
"
onmouseup="
if(curve.checked){}
else{
dawn['down']=false;eff.classList.add('hide');
let x=dawn.x-event.clientX;
let y=dawn.y-event.clientY;
console.log([dawn.x,dawn.y,Math.abs(x),Math.abs(y)].join(','));
if(document.getElementById('ute'))ute.remove();
svg.innerHTML+=`<rect id='ute' x='`
+dawn.x+`' y='`
+dawn.y+`' width='`
+dawn.w+`' height='`
+dawn.h+`' stroke='red' stroke-width='1' fill='none'></rect>`;
//move=0;
}
"

>
<style type="text/css">
.rect1, .polygon1 {stroke: blue;}
.txt1 {font-family: Arial; font-size: 12px; line-height: 0; fill:white;}
textPath {font-family: sans-serif; font-size: 16px;}
</style>
<rect class="x" x="0" y="0" width="900" height="415" fill="#ded"></rect>

<path d="M40 0 V420" stroke="black" stroke-width="1"></path>
<path d="M60 0 V420" stroke="black" stroke-width="1"></path>
<path d="M80 0 V420" stroke="black" stroke-width="1"></path>

<ellipse class="x" cx="462.5" cy="302.5" rx="49.5" ry="10" stroke="blue" fill="cyan" opacity="1" stroke-width="1"></ellipse>
<g id="gogo"></g>

<rect id="eff" class="hide" x="0" y="0" width="90" height="41" stroke="red" fill="none"></rect>
</svg>
</div><br>
<label onclick="but0()">rest</label>
<label onclick="but1()">round</label>
<label onclick="but2()">line /</label>
<label onclick="but3()">line \</label>
<label onclick="but4()">clip</label>

 <article class="palet" style="">
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>	
	<div class="color"></div>	
</article>
<h1 id="h1"></h1><h2 id="h2"></h2><h3 id="h3"></h3>
<input id="curve" type="checkbox" checked />
<script>
let a=[]; // коорды в пикселях
let b=[]; // коорды в процентах
let bz=[]; // сглаженность точки
let c=-1;  // курсор точек
let s;
let au=[];
let bok=0;
const cc=['white','red','black','green','yellow','lime',
'violet','purple','navy','aqua','blue','gold',
'teal','olive','maroon','silver','springgreen','#6c757d','fuchsia'];
let move=null;
let n=0;
let ink=cc[4];
let dawn={x:0,y:0,w:1,h:1};
//натянуть dawn на b


const adi=()=>{// в процентах
	let xma,xmi,yma,ymi,dx,dy;
	let kx,ky;
	if (!a.length) return [];
	xma=a[0].x; yma=a[0].y;
	xmi=a[0].x; ymi=a[0].y;
	a.forEach(i=>{
		if(xma<i.x)xma=i.x;
		if(yma<i.y)yma=i.y;
		if(xmi>i.x)xmi=i.x;
		if(ymi>i.y)ymi=i.y;
		dx=xma-xmi;
		dy=yma-ymi;
		kx=dx/100;
		ky=dy/100;	
		});
	return a.map(i=>{return {
		x:Math.trunc((i.x-xmi)/kx),
		y:Math.trunc((i.y-ymi)/ky),
		}});
}

const vw=()=>{ // рендеринг
    b=adi();
	h3.innerText=b.map(i=>i.x+' '+i.y).join(',');
	//console.log(b);
	s=a.map((i,j)=>
	'<circle r="3" cx="'+(i.x)+
	'" cy="'+(i.y)+
	'" fill="'+((bz[j])?'violet':'red')+'"/>'	
	).join('\n');
	gogo.innerHTML=	
	'<rect x="'+(a[c].x-5)+'" y="'+(a[c].y-5)+'" width="10" height="10" fill="none" stroke="red"/>'
	+s;
	//fly();
}

jp=[...document.querySelectorAll('.color')];
jp.forEach((x,i)=>{
	x.style.background=cc[i]; 
	x.addEventListener('click',()=>{
		ink=cc[i];
	});
});

//jp[0].style.backGround='red';
//alert(jp[0].setAttribute('back'));

const but0=()=>{//alert(dawn.h);
n++;
if(document.getElementById('ute'))ute.remove();// id='mov'
//svg.innerHTML+=`<rect id='j`+n+`' x='`
svg.innerHTML+=`<rect class="fg"  id='r`
+n+`' x='`
+dawn.x+`' y='`
+dawn.y+`' width='`
+dawn.w+`' height='`
+dawn.h+`' fill='`
+ink+`' stroke='black' stroke-width='1' onmousedown='event.stopPropagation(); `
//alert(`+n+`);
+` den0(this); `
+`move=`
+n+`'></rect>`;
au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
console.log(au);
}//onclick='move=this.id'

const but1=()=>{
n++;
if(document.getElementById('ute'))ute.remove();
svg.innerHTML+=
`<ellipse class="fg" id='e`+n+`' rx="`
+(dawn.w/2)+`" ry="`
+(dawn.h/2)+`" cx="`
+(dawn.x+dawn.w/2)+`" cy="`
+(dawn.y+dawn.h/2)+`" fill="`
+ink+`"  stroke='black' stroke-width='1' onmousedown='event.stopPropagation(); `
+` den1(this); `
+`move=`
+n+`'></ellipse>`;
au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
}

const but2=()=>{
n++;
if(document.getElementById('ute'))ute.remove();
svg.innerHTML+=
`<line  class="fg" id='ll`+n+`'  x1="`
+(dawn.x+dawn.w)+`" y1="`
+dawn.y+`" x2="`
+dawn.x+`" y2="`
+(dawn.y+dawn.h)+`" stroke="`
+ink+`" stroke-linecap="square" stroke-width="5" onmousedown='event.stopPropagation(); `
+` den2(this); `
+`move=`
+n+`'></line>`;
au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
}

const but3=()=>{
n++;
if(document.getElementById('ute'))ute.remove();
svg.innerHTML+=
`<line  class="fg" id='ll`+n+`'  x1="`
+dawn.x+`" y1="`
+dawn.y+`" x2="`
+(dawn.x+dawn.w)+`" y2="`
+(dawn.y+dawn.h)+`" stroke="`
+ink+`" stroke-linecap="square" stroke-width="5" onmousedown='event.stopPropagation(); `
+` den3(this); `
+`move=`
+n+`'></line>`;
au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
}

const but4=()=>{
n++;
if(document.getElementById('ute'))ute.remove();
svg.innerHTML+=
`<path class="fg" id='p`+n+`' d="M`
+b.map(i=>(dawn.x+i.x*dawn.w/100)+','+(dawn.y+i.y*dawn.h/100)).join(',')
/*+(dawn.w/2)+`" ry="`
+(dawn.h/2)+`" cx="`
+(dawn.x+dawn.w/2)+`" cy="`
+(dawn.y+dawn.h/2)*/
+`z" fill="`
+ink+`"  stroke='black' stroke-width='1' onmousedown='event.stopPropagation(); `
+` den4(this,`+n+`); `
+`move=`
+n+`'></ellipse>`;
au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
}

/*

n++;
if(document.getElementById('ute'))ute.remove();
svg.innerHTML+=
`<line class="fg" id='j`+n+`' x1="`
+dawn.x+`" y1="`
+dawn.y+`" x2="`
+(dawn.x+dawn.w)+`" y2="`
+(dawn.y+dawn.h)+`" stroke="`
+ink+`" stroke-linecap="square" onclick='move=this.id'/>`
}

*/

const den0=(n)=>{
//alert(n.getAttribute('x'));
dawn.x=n.getAttribute('x');
dawn.y=n.getAttribute('y');
dawn.w=n.getAttribute('width');
dawn.h=n.getAttribute('height');
}
const den1=(n)=>{
//alert(n.getAttribute('x'));
dawn.x=n.getAttribute('cx')-n.getAttribute('rx');
dawn.y=n.getAttribute('cy')-n.getAttribute('ry');
dawn.w=2*n.getAttribute('rx');
dawn.h=2*n.getAttribute('ry');
}
const den2=(n)=>{
//alert(n.getAttribute('x'));
dawn.x=n.getAttribute('x1');
dawn.y=n.getAttribute('y1');
dawn.w=n.getAttribute('x2')+n.getAttribute('x1');
dawn.h=n.getAttribute('y2')+n.getAttribute('y1');
}
const den3=(n)=>{
//alert(n.getAttribute('x'));
dawn.x=n.getAttribute('x1');
dawn.y=n.getAttribute('y1');
dawn.w=n.getAttribute('x2')+n.getAttribute('x1');
dawn.h=n.getAttribute('y2')+n.getAttribute('y1');
}
const den4=(n)=>{
//alert(n.getAttribute('x'));
//=au[n];//au[n]
dawn={};for (let key in au[n]){dawn[key] = au[n][key];}
//dawn.x=n.getAttribute('x1');
//dawn.y=n.getAttribute('y1');
//dawn.w=n.getAttribute('x2')+n.getAttribute('x1');
//dawn.h=n.getAttribute('y2')+n.getAttribute('y1');
}
 //********************* выбранная точка перемещается курсорными клавишами
 document.addEventListener('keydown', (e) => {// ←↑↓→
	// сканирование клавы по обобщенной схеме
	//alert(move);
	h1.innerText=move;
	if(move)
		if(document.getElementById('ute'))
			ute.remove();
	//alert('!');
	switch(e.key) {//
		case 'ArrowDown': //↓
			if(curve.checked){
			if(c+1){a[c].y++;vw();}
			
			}
			else{
			switch (bok){
				case 2: dawn.h++; break;//dawn.y++;
				case 4: dawn.y++; dawn.h--; break;
				case 0: dawn.y++; break;
				}			
				}
				e.preventDefault();
				break;
				
		
		case 'ArrowUp': //↑
			if(curve.checked){
			if(c+1){a[c].y--;vw();}
			}
			else{
			switch (bok){
				case 2: dawn.h--; break;
				case 4: dawn.y--; dawn.h++; break;
				case 0: dawn.y--; break;
				}					
				}
				e.preventDefault();
				break;
						  
		case 'ArrowRight': //→
			if(curve.checked){
			if(c+1){a[c].x++;vw();}
			}
			else{
			switch (bok){
				case 1: dawn.w++; break;
				case 3: dawn.x++; dawn.w--; break;
				case 0: dawn.x++; break;
				}
				}
				e.preventDefault();
				break;
					
		case 'ArrowLeft': //←
			if(curve.checked){
			if(c+1){a[c].x--;vw();}
			}
			else{
			switch (bok){
				case 1: dawn.w--; break;
				case 3: dawn.x--; dawn.w++; break;
				case 0: dawn.x--; break;
				}
				}
				e.preventDefault();
				break;
						

		case '0': if(!curve.checked){bok++;bok=bok%5;}// numpad0	, 0	
		default: break;
	}// switch
	h2.innerText=bok;
//alert(move);
//let d=document.querySelectorAll('fg');

if(document.getElementById('ute')){	
	ute.setAttribute('x',dawn.x);
	ute.setAttribute('y',dawn.y);	
	ute.setAttribute('width',dawn.w);
	ute.setAttribute('height',dawn.h);
	return; 
}	
	//alert('#j'+move);
//if(document.getElementById('ute'))
let b=document.querySelector('#r'+move);
if (b)
{	
//alert(b.id);
b.setAttribute('x',dawn.x);
b.setAttribute('y',dawn.y);	
b.setAttribute('width',dawn.w);
b.setAttribute('height',dawn.h);
return;
}
b=document.querySelector('#e'+move);
if (b)
{	
//alert(b.id);
b.setAttribute('cx',dawn.x+dawn.w/2);
b.setAttribute('cy',dawn.y+dawn.h/2);	
b.setAttribute('rx',dawn.w/2);
b.setAttribute('ry',dawn.h/2);
return;
}
b=document.querySelector('#p'+move);
if (b)
{	
//alert(b.id);
b.setAttribute('cx',dawn.x+dawn.w/2);
b.setAttribute('cy',dawn.y+dawn.h/2);	
b.setAttribute('rx',dawn.w/2);
b.setAttribute('ry',dawn.h/2);
return;
}


	});
//**************************

</script>   
</body>
</html>